# Serein Shop - Dá»± Ã¡n E-commerce Hiá»‡n Äáº¡i

Má»™t dá»± Ã¡n website thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­ (e-commerce) full-stack Ä‘Æ°á»£c xÃ¢y dá»±ng báº±ng Next.js vÃ  Node.js, Ã¡p dá»¥ng kiáº¿n trÃºc hiá»‡n Ä‘áº¡i, há»— trá»£ Ä‘a ngÃ´n ngá»¯, Ä‘a tiá»n tá»‡ vÃ  cung cáº¥p tráº£i nghiá»‡m quáº£n trá»‹ toÃ n diá»‡n.

## ğŸ“ Description

Serein Shop lÃ  má»™t ná»n táº£ng mua sáº¯m trá»±c tuyáº¿n hoÃ n chá»‰nh, Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ mang láº¡i tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng mÆ°á»£t mÃ , trá»±c quan á»Ÿ phÃ­a khÃ¡ch hÃ ng vÃ  má»™t há»‡ thá»‘ng quáº£n trá»‹ máº¡nh máº½, giÃ u tÃ­nh nÄƒng cho quáº£n trá»‹ viÃªn á»Ÿ phÃ­a backend. Dá»± Ã¡n thá»ƒ hiá»‡n sá»± káº¿t há»£p giá»¯a cÃ¡c cÃ´ng nghá»‡ web hiá»‡n Ä‘áº¡i Ä‘á»ƒ giáº£i quyáº¿t cÃ¡c bÃ i toÃ¡n thá»±c táº¿ trong lÄ©nh vá»±c thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­.

### 1. Tá»•ng quan & TÃ­nh nÄƒng chÃ­nh

Trang web Ä‘Æ°á»£c chia thÃ nh hai khu vá»±c chÃ­nh vá»›i cÃ¡c tÃ­nh nÄƒng chuyÃªn biá»‡t:

#### âœ¨ Giao diá»‡n KhÃ¡ch hÃ ng (Client)

- **Tráº£i nghiá»‡m Äa ngÃ´n ngá»¯ & Äa tiá»n tá»‡:** NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ chuyá»ƒn Ä‘á»•i linh hoáº¡t giá»¯a Tiáº¿ng Viá»‡t (VND) vÃ  Tiáº¿ng Anh (USD). Giao diá»‡n, dá»¯ liá»‡u sáº£n pháº©m vÃ  giÃ¡ cáº£ sáº½ tá»± Ä‘á»™ng cáº­p nháº­t theo lá»±a chá»n, vá»›i tá»· giÃ¡ Ä‘Æ°á»£c láº¥y real-time.
- **Trang chá»§ Ä‘á»™ng:** Hiá»ƒn thá»‹ cÃ¡c banner quáº£ng cÃ¡o, sáº£n pháº©m ná»•i báº­t vÃ  sáº£n pháº©m má»›i nháº¥t Ä‘Æ°á»£c quáº£n lÃ½ hoÃ n toÃ n tá»« trang admin.
- **Duyá»‡t sáº£n pháº©m nÃ¢ng cao:** Trang danh sÃ¡ch sáº£n pháº©m vá»›i bá»™ lá»c Ä‘a tiÃªu chÃ­ (danh má»¥c, khoáº£ng giÃ¡, thuá»™c tÃ­nh nhÆ° mÃ u sáº¯c/kÃ­ch thÆ°á»›c, Ä‘Ã¡nh giÃ¡) vÃ  cÃ¡c tÃ¹y chá»n sáº¯p xáº¿p.
- **Chi tiáº¿t sáº£n pháº©m thÃ´ng minh:** Há»— trá»£ sáº£n pháº©m cÃ³ nhiá»u biáº¿n thá»ƒ (variants), tá»± Ä‘á»™ng cáº­p nháº­t hÃ¬nh áº£nh, giÃ¡ vÃ  SKU khi ngÆ°á»i dÃ¹ng chá»n tÃ¹y chá»n.
- **Giá» hÃ ng vÃ  Thanh toÃ¡n liá»n máº¡ch:** Giá» hÃ ng thÃ´ng minh, tá»± Ä‘á»™ng gá»™p sáº£n pháº©m, Ã¡p dá»¥ng mÃ£ giáº£m giÃ¡ vÃ  quy trÃ¬nh thanh toÃ¡n Ä‘a phÆ°Æ¡ng thá»©c (COD, Chuyá»ƒn khoáº£n, tÃ­ch há»£p PayPal Sandbox).
- **Quáº£n lÃ½ tÃ i khoáº£n cÃ¡ nhÃ¢n:** NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ Ä‘Äƒng kÃ½/Ä‘Äƒng nháº­p (xÃ¡c thá»±c JWT), quáº£n lÃ½ thÃ´ng tin, sá»• Ä‘á»‹a chá»‰, xem láº¡i lá»‹ch sá»­ Ä‘Æ¡n hÃ ng chi tiáº¿t vÃ  theo dÃµi Ä‘Æ¡n hÃ ng (cho cáº£ khÃ¡ch vÃ£ng lai).
- **TÆ°Æ¡ng tÃ¡c ngÆ°á»i dÃ¹ng:** Há»‡ thá»‘ng Ä‘Ã¡nh giÃ¡ sáº£n pháº©m (cÃ³ áº£nh) vÃ  danh sÃ¡ch yÃªu thÃ­ch (wishlist).

#### ğŸš€ Giao diá»‡n Quáº£n trá»‹ viÃªn (Admin)

- **Báº£ng Ä‘iá»u khiá»ƒn (Dashboard) trá»±c quan:** Cung cáº¥p cÃ¡i nhÃ¬n tá»•ng quan vá» hoáº¡t Ä‘á»™ng kinh doanh vá»›i cÃ¡c biá»ƒu Ä‘á»“ (Ä‘Æ°á»ng, cá»™t, trÃ²n) vÃ  tháº» thá»‘ng kÃª vá» doanh thu, Ä‘Æ¡n hÃ ng, khÃ¡ch hÃ ng má»›i. Dá»¯ liá»‡u cÃ³ thá»ƒ Ä‘Æ°á»£c lá»c theo cÃ¡c khoáº£ng thá»i gian tÃ¹y chá»n (tuáº§n, thÃ¡ng, quÃ½, nÄƒm).
- **BÃ¡o cÃ¡o & PhÃ¢n tÃ­ch chuyÃªn sÃ¢u:** CÃ¡c bÃ¡o cÃ¡o chi tiáº¿t vá» BÃ¡n hÃ ng, Sáº£n pháº©m (top bÃ¡n cháº¡y theo sá»‘ lÆ°á»£ng/doanh thu), KhÃ¡ch hÃ ng (top chi tiÃªu) vÃ  Tá»“n kho (sáº£n pháº©m sáº¯p háº¿t/háº¿t hÃ ng).
- **Quáº£n lÃ½ Sáº£n pháº©m (CRUD):** Giao diá»‡n thÃªm/sá»­a/xÃ³a sáº£n pháº©m vá»›i trÃ¬nh soáº¡n tháº£o vÄƒn báº£n (CKEditor), quáº£n lÃ½ thuá»™c tÃ­nh, táº¡o biáº¿n thá»ƒ hÃ ng loáº¡t vÃ  tá»± Ä‘á»™ng táº¡o SKU.
- **Quáº£n lÃ½ ÄÆ¡n hÃ ng:** Xem danh sÃ¡ch Ä‘Æ¡n hÃ ng vá»›i bá»™ lá»c, xem chi tiáº¿t, cáº­p nháº­t tráº¡ng thÃ¡i, xá»­ lÃ½ yÃªu cáº§u há»§y/hoÃ n tiá»n tá»« khÃ¡ch hÃ ng, vÃ  thá»±c hiá»‡n hoÃ n tiá»n (refund) qua PayPal.
- **Quáº£n lÃ½ NgÆ°á»i dÃ¹ng:** Xem danh sÃ¡ch khÃ¡ch hÃ ng, thÃ´ng tin chi tiáº¿t (tá»•ng chi tiÃªu, sá»‘ Ä‘Æ¡n hÃ ng), vÃ  chá»©c nÄƒng Ä‘Ã¬nh chá»‰/kÃ­ch hoáº¡t tÃ i khoáº£n.
- **Há»‡ thá»‘ng Khuyáº¿n mÃ£i:** Táº¡o vÃ  quáº£n lÃ½ mÃ£ giáº£m giÃ¡ (coupon) vá»›i nhiá»u Ä‘iá»u kiá»‡n phá»©c táº¡p (theo %, sá»‘ tiá»n cá»‘ Ä‘á»‹nh, Ä‘Æ¡n hÃ ng tá»‘i thiá»ƒu, Ã¡p dá»¥ng cho sáº£n pháº©m/danh má»¥c cá»¥ thá»ƒ).
- **Quáº£n lÃ½ Ná»™i dung & CÃ i Ä‘áº·t:** Cho phÃ©p admin tÃ¹y chá»‰nh cÃ¡c banner trÃªn trang chá»§, cÃ i Ä‘áº·t ngÃ´n ngá»¯/tiá»n tá»‡ máº·c Ä‘á»‹nh, vÃ  cáº¥u hÃ¬nh sá»‘ lÆ°á»£ng item hiá»ƒn thá»‹ trÃªn cÃ¡c trang.

### 2. CÃ¡ch tá»• chá»©c thÆ° má»¥c dá»± Ã¡n

Dá»± Ã¡n Ä‘Æ°á»£c tÃ¡ch thÃ nh hai pháº§n riÃªng biá»‡t: `frontend` vÃ  `backend`, vá»›i cáº¥u trÃºc module hÃ³a rÃµ rÃ ng.

#### **Front-end (Next.js)**

- **`src/app/[locale]`**: Cáº¥u trÃºc route Ä‘á»™ng cá»‘t lÃµi cá»§a **App Router**, lÃ  nÆ¡i chá»©a toÃ n bá»™ cÃ¡c trang vÃ  layout, xá»­ lÃ½ Ä‘a ngÃ´n ngá»¯ má»™t cÃ¡ch tá»± nhiÃªn. CÃ¡c route Ä‘Æ°á»£c nhÃ³m theo chá»©c nÄƒng (`(main)`, `admin`).
- **`src/components`**: Chá»©a cÃ¡c component React cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng, Ä‘Æ°á»£c phÃ¢n chia thÃ nh `client`, `admin`, vÃ  `shared` (dÃ¹ng chung).
- **`src/constants`**: Chá»©a cÃ¡c Ä‘á»‹nh nghÄ©a biáº¿n.
- **`src/lib`**: Chá»©a cÃ¡c logic cá»‘t lÃµi nhÆ° axiosInstance (Ä‘á»ƒ gá»i API), react-query (quáº£n lÃ½ state phÃ­a server).
- **`src/lib/react-query`**: Chá»©a cÃ¡c custom hook (`useQuery`, `useMutation`) cá»§a **TanStack Query**, Ä‘Ã³ng gÃ³i logic fetch vÃ  quáº£n lÃ½ state tá»« server.
- **`src/services`**: Táº§ng giao tiáº¿p API, chá»©a cÃ¡c hÃ m gá»i API cá»¥ thá»ƒ báº±ng **Axios**.
- **`src/store`**: Chá»©a cÃ¡c slice cá»§a **Redux Toolkit** Ä‘á»ƒ quáº£n lÃ½ state toÃ n cá»¥c phÃ­a client (tráº¡ng thÃ¡i xÃ¡c thá»±c, giá» hÃ ng checkout, cÃ i Ä‘áº·t giao diá»‡n).
- **`src/types`**: Chá»©a cÃ¡c `interface` **TypeScript** Ä‘á»‹nh nghÄ©a cáº¥u trÃºc dá»¯ liá»‡u cho toÃ n bá»™ dá»± Ã¡n.
- **`src/i18n` & `src/middleware.ts`**: Chá»©a cÃ¡c file cáº¥u hÃ¬nh vÃ  Ä‘iá»u hÆ°á»›ng cho thÆ° viá»‡n **next-intl**.

#### **Back-end (Node.js/Express)**

- Sá»­ dá»¥ng mÃ´ hÃ¬nh kiáº¿n trÃºc **MVC (Model-View-Controller)**.
- **`src/models`**: Äá»‹nh nghÄ©a cÃ¡c **Schema** cá»§a **Mongoose** vá»›i cáº¥u trÃºc Ä‘a ngÃ´n ngá»¯.
- **`src/controllers`**: Chá»©a toÃ n bá»™ logic nghiá»‡p vá»¥, xá»­ lÃ½ request vÃ  tÆ°Æ¡ng tÃ¡c vá»›i Model. Sá»­ dá»¥ng máº¡nh máº½ **Aggregation Pipeline** cá»§a MongoDB Ä‘á»ƒ tá»•ng há»£p dá»¯ liá»‡u phá»©c táº¡p.
- **`src/routes`**: Äá»‹nh nghÄ©a cÃ¡c endpoint API theo chuáº©n RESTful.
- **`src/middlewares`**: Chá»©a cÃ¡c hÃ m trung gian nhÆ° xÃ¡c thá»±c token JWT, kiá»ƒm tra quyá»n admin, xÃ¡c thá»±c dá»¯ liá»‡u Ä‘áº§u vÃ o báº±ng **Joi**, vÃ  xá»­ lÃ½ ngÃ´n ngá»¯.
- **`src/utils`**: Chá»©a cÃ¡c hÃ m tiá»‡n Ã­ch dÃ¹ng chung nhÆ° gá»­i email, xá»­ lÃ½ upload, táº¡o token, v.v.
- **`src/validations`**: Chá»©a cÃ¡c phÆ°Æ¡ng thá»©c validate cho cÃ¡c dá»¯ liá»‡u cá»§a cÃ¡c API.
- **`src/config`**: Chá»©a config cho MongoDB vÃ  Cloudinary.

### 3. Luá»“ng thá»±c thi cá»§a dá»± Ã¡n

1. **Khá»Ÿi Ä‘á»™ng:** Hai server (Next.js vÃ  Express) cháº¡y Ä‘á»™c láº­p.
2. **API Call:** Giao diá»‡n frontend thá»±c hiá»‡n cÃ¡c lá»i gá»i API Ä‘áº¿n backend.
3. **Xá»­ lÃ½ Backend:** Má»™t request API sáº½ cháº¡y qua luá»“ng: **Routes** â†’ **Middlewares** (xÃ¡c thá»±c, validation, ngÃ´n ngá»¯) â†’ **Controllers** (logic nghiá»‡p vá»¥) â†’ **Models** (tÆ°Æ¡ng tÃ¡c CSDL MongoDB).
4. **Hiá»ƒn thá»‹:** Frontend nháº­n response, cáº­p nháº­t state, vÃ  re-render giao diá»‡n.

---

## âš™ï¸ Technology

Dá»± Ã¡n Ä‘Æ°á»£c xÃ¢y dá»±ng trÃªn ná»n táº£ng MERN stack Ä‘Ã£ Ä‘Æ°á»£c tÃ¹y chá»‰nh vÃ  má»Ÿ rá»™ng vá»›i cÃ¡c cÃ´ng nghá»‡ hiá»‡n Ä‘áº¡i, táº­p trung vÃ o hiá»‡u suáº¥t, kháº£ nÄƒng má»Ÿ rá»™ng vÃ  tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng.

### Front-end

- [**React 19**](https://react.dev/) & [**Next.js 15**](https://nextjs.org/) (App Router & Turbopack)
- [**TypeScript**](https://www.typescriptlang.org/)
- [**Tailwind CSS v4**](https://tailwindcss.com/)
- **State Management:**
  - [**TanStack Query (React Query) v5**](https://tanstack.com/query/latest)
  - [**Redux Toolkit**](https://redux-toolkit.js.org/)
- **UI Components:**
  - [**Headless UI**](https://headlessui.com/) (cho Client)
  - [**CoreUI for React v5**](https://coreui.io/react/) (cho Admin)
- **Charting:**
  - [**Chart.js v4**](https://www.chartjs.org/)
  - [**react-chartjs-2 v5**](https://react-chartjs-2.js.org/)
- **Internationalization (i18n):**
  - [**next-intl**](https://next-intl.dev/)
- **Rich Text Editor:**
  - [**CKEditor 5**](https://ckeditor.com/ckeditor-5/)
- **Payments:**
  - [**@paypal/react-paypal-js**](https://www.npmjs.com/package/@paypal/react-paypal-js)
- **HTTP Client:**
  - [**Axios**](https://axios-http.com/)
- **Utilities:**
  - [**Swiper.js**](https://swiperjs.com/) (Slider/Carousel)
  - [**date-fns**](https://date-fns.org/) (Thao tÃ¡c ngÃ y thÃ¡ng)
  - [**react-hot-toast**](https://react-hot-toast.com/) (ThÃ´ng bÃ¡o)
  - [**react-icons**](https://react-icons.github.io/react-icons/) (Bá»™ icon)
  - [**classnames**](https://github.com/JedWatson/classnames) (Ná»‘i class Ä‘á»™ng)
- **Real-time:**
  - [**Socket.IO Client**](https://socket.io/)

### Back-end

- **Runtime:**
  - [**Node.js**](https://nodejs.org/)
- **Framework:**
  - [**Express.js v5**](https://expressjs.com/)
- **Database ODM:**
  - [**Mongoose v8**](https://mongoosejs.com/)
- **Authentication:**
  - [**JSON Web Token (JWT)**](https://jwt.io/)
  - [**bcrypt**](https://www.npmjs.com/package/bcrypt)
- **Validation:**
  - [**Joi v17**](https://joi.dev/)
- **File Uploads:**
  - [**Multer**](https://github.com/expressjs/multer)
  - [**Cloudinary v2**](https://cloudinary.com/)
- **Utilities:**
  - [**Nodemailer**](https://nodemailer.com/) (Gá»­i email)
  - [**Winston**](https://github.com/winstonjs/winston) (Logging)
  - [**Socket.IO**](https://socket.io/) (Real-time Communication)
  - [**slugify**](https://www.npmjs.com/package/slugify) (Táº¡o URL thÃ¢n thiá»‡n)
- **Development:**
  - [**Nodemon**](https://nodemon.io/)
- **Testing:**
  - [**Jest**](https://jestjs.io/)
  - [**Supertest**](https://www.npmjs.com/package/supertest)

### Database

- **NoSQL:** [**MongoDB**](https://www.mongodb.com/)

## ğŸ’» Code Explanation

Pháº§n nÃ y sáº½ Ä‘i sÃ¢u vÃ o chi tiáº¿t kiáº¿n trÃºc vÃ  logic cá»§a tá»«ng pháº§n trong dá»± Ã¡n.

### 1. Front-end

Frontend Ä‘Æ°á»£c xÃ¢y dá»±ng báº±ng **Next.js 15** theo kiáº¿n trÃºc **App Router**, **TypeScript**, **CoreUI** vÃ  **Tailwind CSS**, táº¡o ra má»™t á»©ng dá»¥ng web hiá»‡n Ä‘áº¡i, hiá»‡u suáº¥t cao vÃ  cÃ³ kháº£ nÄƒng má»Ÿ rá»™ng. Kiáº¿n trÃºc Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ tÃ¡ch biá»‡t rÃµ rÃ ng cÃ¡c má»‘i quan tÃ¢m (separation of concerns) vÃ  tá»‘i Æ°u hÃ³a tráº£i nghiá»‡m cho cáº£ ngÆ°á»i dÃ¹ng cuá»‘i vÃ  nhÃ  phÃ¡t triá»ƒn.

#### `src/app` - Kiáº¿n trÃºc Route vÃ  Äa ngÃ´n ngá»¯ (i18n)

Kiáº¿n trÃºc thÆ° má»¥c `app` lÃ  trÃ¡i tim cá»§a á»©ng dá»¥ng, táº­n dá»¥ng tá»‘i Ä‘a cÃ¡c tÃ­nh nÄƒng cá»§a App Router.

- **App Router & Route Ä‘á»™ng `[locale]`:** ToÃ n bá»™ á»©ng dá»¥ng Ä‘Æ°á»£c lá»“ng trong thÆ° má»¥c `app/[locale]`. ÄÃ¢y lÃ  ná»n táº£ng cho há»‡ thá»‘ng Ä‘a ngÃ´n ngá»¯ báº±ng `next-intl`. Middleware sáº½ cháº·n cÃ¡c request, xÃ¡c Ä‘á»‹nh `locale` ('vi' hoáº·c 'en') vÃ  chuyá»ƒn nÃ³ vÃ o `params` cho `layout.tsx` vÃ  `page.tsx`.
- **Route Groups `(main)` & `(admin)`:** CÃ¡c route Ä‘Æ°á»£c nhÃ³m báº±ng dáº¥u ngoáº·c Ä‘Æ¡n Ä‘á»ƒ tá»• chá»©c code vÃ  Ã¡p dá»¥ng cÃ¡c layout khÃ¡c nhau mÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n URL cuá»‘i cÃ¹ng.
  - `(main)`: Chá»©a táº¥t cáº£ cÃ¡c trang dÃ nh cho khÃ¡ch hÃ ng (`/products`, `/cart`, `/profile`,...). NÃ³ sá»­ dá»¥ng `(main)/layout.tsx` Ä‘á»ƒ hiá»ƒn thá»‹ Header, Footer vÃ  cÃ¡c thÃ nh pháº§n chung cá»§a trang client.
  - `admin`: Chá»©a toÃ n bá»™ giao diá»‡n quáº£n trá»‹, sá»­ dá»¥ng `admin/layout.tsx` riÃªng biá»‡t vá»›i Sidebar vÃ  Header cá»§a admin.
- **Server & Client Components:**
  - **Server Components (`page.tsx`, `layout.tsx`):** ÄÆ°á»£c Æ°u tiÃªn sá»­ dá»¥ng Ä‘á»ƒ tá»‘i Æ°u SEO vÃ  tá»‘c Ä‘á»™ táº£i trang ban Ä‘áº§u. ChÃºng cÃ³ thá»ƒ `async` Ä‘á»ƒ fetch dá»¯ liá»‡u trá»±c tiáº¿p trÃªn server, giáº£m thiá»ƒu sá»‘ láº§n gá»i API tá»« client.
  - **Client Components (`"use client"`):** ÄÆ°á»£c sá»­ dá»¥ng cho cÃ¡c trang/component cÃ³ tÃ­nh tÆ°Æ¡ng tÃ¡c cao (sá»­ dá»¥ng `useState`, `useEffect`, vÃ  cÃ¡c event handler). VÃ­ dá»¥, `ProductsPageClient.tsx` quáº£n lÃ½ toÃ n bá»™ logic lá»c vÃ  phÃ¢n trang, trong khi `page.tsx` cha chá»‰ Ä‘Æ¡n giáº£n lÃ  render nÃ³.
- **Providers & Context:**
  - **`QueryProvider.tsx`, `SettingsContext.tsx`:** CÃ¡c provider nÃ y Ä‘Æ°á»£c Ä‘áº·t á»Ÿ gá»‘c thÆ° má»¥c `app` vÃ  render bÃªn trong `[locale]/layout.tsx`, Ä‘áº£m báº£o toÃ n bá»™ á»©ng dá»¥ng client-side Ä‘Æ°á»£c bá»c trong cÃ¡c context cáº§n thiáº¿t.
  - **`AuthInitializerWrapper.tsx`:** Má»™t wrapper quan trá»ng, sá»­ dá»¥ng hook `useAuthInitializer` Ä‘á»ƒ xÃ¡c thá»±c phiÃªn Ä‘Äƒng nháº­p cá»§a ngÆ°á»i dÃ¹ng (thÃ´ng qua refresh token) trÆ°á»›c khi render toÃ n bá»™ giao diá»‡n. NÃ³ hiá»ƒn thá»‹ má»™t mÃ n hÃ¬nh loading toÃ n cá»¥c, ngÄƒn cháº·n hiá»‡n tÆ°á»£ng "nháº¥p nhÃ¡y" giao diá»‡n.

#### `src/components` - ThÆ° viá»‡n Component TÃ¡i sá»­ dá»¥ng

ÄÃ¢y lÃ  nÆ¡i chá»©a toÃ n bá»™ cÃ¡c "viÃªn gáº¡ch" xÃ¢y dá»±ng nÃªn giao diá»‡n, Ä‘Æ°á»£c tá»• chá»©c thÃ nh ba cáº¥p Ä‘á»ƒ tá»‘i Ä‘a hÃ³a kháº£ nÄƒng tÃ¡i sá»­ dá»¥ng vÃ  dá»… dÃ ng quáº£n lÃ½.

- **`shared`**: Chá»©a cÃ¡c component chung nháº¥t, cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng á»Ÿ cáº£ trang client vÃ  admin. ChÃºng thÆ°á»ng lÃ  cÃ¡c thÃ nh pháº§n UI cÆ¡ báº£n hoáº·c cÃ¡c tiá»‡n Ã­ch khÃ´ng phá»¥ thuá»™c vÃ o ngá»¯ cáº£nh cá»¥ thá»ƒ.
  - VÃ­ dá»¥: `ConfirmationModal.tsx` (modal xÃ¡c nháº­n hÃ nh Ä‘á»™ng), `RatingStars.tsx` (hiá»ƒn thá»‹ sao Ä‘Ã¡nh giÃ¡), `CustomEditor.tsx` (trÃ¬nh soáº¡n tháº£o CKEditor), `SettingsSwitcher.tsx` (bá»™ chuyá»ƒn Ä‘á»•i ngÃ´n ngá»¯/tiá»n tá»‡).
- **`client`**: Chá»©a cÃ¡c component dÃ nh riÃªng cho giao diá»‡n khÃ¡ch hÃ ng, thÆ°á»ng cÃ³ logic vÃ  giao diá»‡n phá»©c táº¡p hÆ¡n, liÃªn quan trá»±c tiáº¿p Ä‘áº¿n tráº£i nghiá»‡m mua sáº¯m.
  - VÃ­ dá»¥: `HeroBanner.tsx` (slider trang chá»§), `ProductCard.tsx` (tháº» sáº£n pháº©m), `CheckoutForm.tsx` (form thanh toÃ¡n), `CategoryMenu.tsx` (mega menu).
- **`admin`**: Chá»©a cÃ¡c component dÃ nh riÃªng cho trang quáº£n trá»‹, Ä‘Æ°á»£c xÃ¢y dá»±ng chá»§ yáº¿u báº±ng **CoreUI for React** Ä‘á»ƒ táº¡o ra giao diá»‡n dashboard chuyÃªn nghiá»‡p.
  - VÃ­ dá»¥: `AdminSidebar.tsx`, `DataTablePagination.tsx`, cÃ¡c component báº£ng (`ProductTable`, `OrderTable`), vÃ  cÃ¡c component form trong modal (`CouponForm`, `AttributeValueFormModal`).

#### `src/types`

ÄÃ¢y lÃ  "nguá»“n sá»± tháº­t" vá» cáº¥u trÃºc dá»¯ liá»‡u cá»§a toÃ n bá»™ á»©ng dá»¥ng.

- **Äá»‹nh nghÄ©a Type:** Sá»­ dá»¥ng **TypeScript `interface` vÃ  `type`** Ä‘á»ƒ Ä‘á»‹nh nghÄ©a cáº¥u trÃºc cho má»i Ä‘á»‘i tÆ°á»£ng dá»¯ liá»‡u, tá»« cÃ¡c model database (`Product`, `Order`, `User`) Ä‘áº¿n cÃ¡c payload API (`OrderCreationPayload`) vÃ  response (`PaginatedProductsResponse`).
- **TÃ¡ch biá»‡t Client & Admin:** Äá»‘i vá»›i cÃ¡c model cÃ³ cáº¥u trÃºc Ä‘a ngÃ´n ngá»¯, cÃ¡c type Ä‘Æ°á»£c tÃ¡ch biá»‡t rÃµ rÃ ng:
  - `ProductAdmin`, `CategoryAdmin`: Äáº¡i diá»‡n cho dá»¯ liá»‡u gá»‘c tá»« database vá»›i cÃ¡c trÆ°á»ng Ä‘a ngÃ´n ngá»¯ (`name: { vi, en }`). ÄÆ°á»£c sá»­ dá»¥ng trong cÃ¡c form admin.
  - `Product`, `Category`: Äáº¡i diá»‡n cho dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c "lÃ m pháº³ng" (`name: string`). ÄÆ°á»£c sá»­ dá»¥ng trÃªn toÃ n bá»™ trang client vÃ  trong cÃ¡c báº£ng hiá»ƒn thá»‹ cá»§a admin.
- **`I18nField`:** Má»™t type dÃ¹ng chung `{ vi: string; en: string; }` Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n cho táº¥t cáº£ cÃ¡c trÆ°á»ng Ä‘a ngÃ´n ngá»¯.

#### `src/constants`

ThÆ° má»¥c nÃ y chá»©a cÃ¡c giÃ¡ trá»‹ khÃ´ng Ä‘á»•i, Ä‘Æ°á»£c sá»­ dá»¥ng á»Ÿ nhiá»u nÆ¡i trong á»©ng dá»¥ng Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n vÃ  dá»… dÃ ng thay Ä‘á»•i khi cáº§n.

- **`filters.ts`**: Äá»‹nh nghÄ©a cÃ¡c khoáº£ng giÃ¡ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh trÆ°á»›c cho bá»™ lá»c sáº£n pháº©m.
- **`orderConstants.ts`**: Chá»©a máº£ng cÃ¡c tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng, bao gá»“m `value` (dÃ¹ng trong logic) vÃ  `label`/`color` (dÃ¹ng cho hiá»ƒn thá»‹ badge).

#### `src/lib` - Táº§ng Logic & Quáº£n lÃ½ State

ÄÃ¢y lÃ  nÆ¡i chá»©a cÃ¡c logic cá»‘t lÃµi, khÃ´ng phá»¥ thuá»™c trá»±c tiáº¿p vÃ o giao diá»‡n.

- **`lib/react-query` (TanStack Query):** "Bá»™ nÃ£o" cá»§a viá»‡c quáº£n lÃ½ dá»¯ liá»‡u tá»« server.
  - **Custom Hooks:** Má»—i resource API cÃ³ má»™t file query riÃªng (`productQueries.tsx`). CÃ¡c hook nhÆ° `useGetProducts`, `useCreateProduct` Ä‘Ã³ng gÃ³i hoÃ n toÃ n logic gá»i API, caching, vÃ  invalidation.
  - **Quáº£n lÃ½ Cache:** Sá»­ dá»¥ng `queryKey` cÃ³ cáº¥u trÃºc Ä‘á»ƒ quáº£n lÃ½ cache hiá»‡u quáº£, tá»± Ä‘á»™ng cáº­p nháº­t giao diá»‡n khi dá»¯ liá»‡u thay Ä‘á»•i á»Ÿ backend.
- **`lib/axiosInstance.ts`**: Cáº¥u hÃ¬nh má»™t instance Axios duy nháº¥t.
  - **Interceptors:** Sá»­ dá»¥ng `interceptors` Ä‘á»ƒ tá»± Ä‘á»™ng Ä‘Ã­nh kÃ¨m **JWT Access Token** vÃ  header `Accept-Language`, cÅ©ng nhÆ° xá»­ lÃ½ logic lÃ m má»›i token vÃ  tá»± Ä‘á»™ng logout.
- **`lib/utils.ts`**: Chá»©a cÃ¡c hÃ m tiá»‡n Ã­ch thuáº§n tÃºy nhÆ° `formatCurrency` (há»— trá»£ Ä‘a tiá»n tá»‡), `getLocalizedName` (xá»­ lÃ½ dá»¯ liá»‡u Ä‘a ngÃ´n ngá»¯), `timeAgo`, v.v.

#### `src/services`

Táº§ng nÃ y lÃ  cáº§u ná»‘i trá»±c tiáº¿p giá»¯a á»©ng dá»¥ng vÃ  cÃ¡c endpoint API cá»§a backend.

- **TÃ¡ch biá»‡t:** Má»—i file service (`productService.ts`, `orderService.ts`) tÆ°Æ¡ng á»©ng vá»›i má»™t controller á»Ÿ backend.
- **Type-safe:** CÃ¡c hÃ m Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a type cháº·t cháº½ báº±ng **TypeScript**, nháº­n vÃ o payload vÃ  tráº£ vá» response vá»›i cÃ¡c `interface` Ä‘Ã£ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong `src/types`.

#### `src/store` (Redux Toolkit)

Quáº£n lÃ½ cÃ¡c state toÃ n cá»¥c phÃ­a client.

- **`authSlice`**: LÆ°u trá»¯ thÃ´ng tin user, `accessToken`, vÃ  tráº¡ng thÃ¡i `isAuthenticated`.
- **`checkoutSlice`**: LÆ°u ID cá»§a cÃ¡c sáº£n pháº©m Ä‘Æ°á»£c chá»n tá»« giá» hÃ ng Ä‘á»ƒ mang sang trang thanh toÃ¡n.
- **`breadcrumbSlice`**: Giáº£i phÃ¡p sá»­ dá»¥ng Redux Ä‘á»ƒ cÃ¡c trang con cÃ³ thá»ƒ gá»­i dá»¯ liá»‡u Ä‘á»™ng (nhÆ° tÃªn sáº£n pháº©m) ngÆ°á»£c lÃªn cho component `AdminBreadcrumb` á»Ÿ layout cha.

#### `src/i18n` & `src/middleware.ts`

- **`next-intl`:** ThÆ° viá»‡n Ä‘Æ°á»£c chá»n Ä‘á»ƒ triá»ƒn khai i18n.
- **`messages/*.json`:** Chá»©a cÃ¡c chuá»—i dá»‹ch tÄ©nh cho giao diá»‡n.
- **`middleware.ts`:**
  - Xá»­ lÃ½ Ä‘á»‹nh tuyáº¿n ngÃ´n ngá»¯. NÃ³ Æ°u tiÃªn **cookie cá»§a ngÆ°á»i dÃ¹ng**, sau Ä‘Ã³ má»›i Ä‘áº¿n **cÃ i Ä‘áº·t máº·c Ä‘á»‹nh cá»§a admin** (láº¥y qua API call).
  - Tá»± Ä‘á»™ng chuyá»ƒn hÆ°á»›ng Ä‘áº¿n URL cÃ³ tiá»n tá»‘ ngÃ´n ngá»¯ (vÃ­ dá»¥: `/vi` hoáº·c `/en`).
- **`navigation.ts`:** Táº¡o ra cÃ¡c phiÃªn báº£n "báº£n Ä‘á»‹a hÃ³a" cá»§a `useRouter`, `usePathname` vÃ  `Link`.

### 2. Back-end

Backend Ä‘Æ°á»£c xÃ¢y dá»±ng theo kiáº¿n trÃºc **MVC (Model-View-Controller)** má»Ÿ rá»™ng, táº­p trung vÃ o tÃ­nh module hÃ³a, kháº£ nÄƒng báº£o trÃ¬ vÃ  xá»­ lÃ½ báº¥t Ä‘á»“ng bá»™ hiá»‡u quáº£.

#### Config (`src/config`)

- **`db.js`**: Quáº£n lÃ½ viá»‡c káº¿t ná»‘i Ä‘áº¿n **MongoDB** báº±ng Mongoose. NÃ³ Ä‘á»c chuá»—i káº¿t ná»‘i tá»« biáº¿n mÃ´i trÆ°á»ng `MONGODB_URI` vÃ  xá»­ lÃ½ lá»—i má»™t cÃ¡ch an toÃ n, Ä‘áº£m báº£o á»©ng dá»¥ng sáº½ thoÃ¡t náº¿u khÃ´ng káº¿t ná»‘i Ä‘Æ°á»£c database.
- **`cloudinary.js`**: Cáº¥u hÃ¬nh SDK cá»§a **Cloudinary** vá»›i cÃ¡c thÃ´ng tin xÃ¡c thá»±c tá»« biáº¿n mÃ´i trÆ°á»ng, sáºµn sÃ ng cho viá»‡c upload file.

#### Models (`src/models`)

ÄÃ¢y lÃ  táº§ng dá»¯ liá»‡u, Ä‘á»‹nh nghÄ©a cáº¥u trÃºc cho cÃ¡c collection trong MongoDB báº±ng **Mongoose ODM**. Má»—i file trong thÆ° má»¥c nÃ y tÆ°Æ¡ng á»©ng vá»›i má»™t collection.

- **Kiáº¿n trÃºc Äa ngÃ´n ngá»¯ (i18n):** CÃ¡c trÆ°á»ng vÄƒn báº£n cáº§n dá»‹ch (nhÆ° `name`, `description`) sá»­ dá»¥ng má»™t `i18nStringSchema` chung, lÆ°u dá»¯ liá»‡u dÆ°á»›i dáº¡ng object `{ vi: '...', en: '...' }`.
- **Dá»¯ liá»‡u NhÃºng & Tham chiáº¿u:** Káº¿t há»£p linh hoáº¡t giá»¯a viá»‡c nhÃºng dá»¯ liá»‡u (Embedding) cho cÃ¡c thÃ´ng tin cÃ³ quan há»‡ cháº·t cháº½ (vÃ­ dá»¥: `Product.variants`, `Order.orderItems`) vÃ  tham chiáº¿u (Referencing) qua `ObjectId` vÃ  `ref` cho cÃ¡c má»‘i quan há»‡ logic (`Product` -> `Category`, `Order` -> `User`).
- **Tá»± Ä‘á»™ng hÃ³a:** Sá»­ dá»¥ng cÃ¡c hook `pre('save')` cá»§a Mongoose Ä‘á»ƒ tá»± Ä‘á»™ng hÃ³a cÃ¡c tÃ¡c vá»¥ nhÆ° táº¡o `slug`.

**CÃ¡c Model chÃ­nh:**

- `User`: LÆ°u thÃ´ng tin khÃ¡ch hÃ ng vÃ  admin, bao gá»“m cáº£ tráº¡ng thÃ¡i `isActive`.
- `Product`: LÆ°u thÃ´ng tin sáº£n pháº©m, bao gá»“m cÃ¡c biáº¿n thá»ƒ (variants) vÃ  thuá»™c tÃ­nh (attributes) Ä‘a ngÃ´n ngá»¯.
- `Category`: LÆ°u danh má»¥c sáº£n pháº©m vá»›i cáº¥u trÃºc cha-con Ä‘á»‡ quy.
- `Order`: LÆ°u "snapshot" Ä‘a ngÃ´n ngá»¯ cá»§a má»™t Ä‘Æ¡n hÃ ng táº¡i thá»i Ä‘iá»ƒm mua, Ä‘áº£m báº£o tÃ­nh toÃ n váº¹n lá»‹ch sá»­.
- `Attribute`, `Coupon`, `Review`, `Setting`, `Cart`, `Wishlist`, `Notification`.

#### Validations (`src/validations`)

- **Ná»n táº£ng:** Sá»­ dá»¥ng thÆ° viá»‡n **Joi** Ä‘á»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c schema xÃ¡c thá»±c cho dá»¯ liá»‡u Ä‘áº§u vÃ o.
- **Validation chi tiáº¿t:** Má»—i schema Ä‘á»‹nh nghÄ©a cÃ¡c quy táº¯c cháº·t cháº½ cho tá»«ng trÆ°á»ng: kiá»ƒu dá»¯ liá»‡u, Ä‘á»™ dÃ i, Ä‘á»‹nh dáº¡ng (regex), vÃ  cÃ¡c thÃ´ng bÃ¡o lá»—i tÃ¹y chá»‰nh báº±ng Tiáº¿ng Viá»‡t.
- **Xá»­ lÃ½ Äa ngÃ´n ngá»¯:** Schema `i18nStringSchema` cá»§a Joi Ä‘Æ°á»£c táº¡o ra Ä‘á»ƒ xÃ¡c thá»±c cÃ¡c object `{ vi, en }`, Ä‘áº£m báº£o dá»¯ liá»‡u Ä‘a ngÃ´n ngá»¯ Ä‘áº§u vÃ o luÃ´n há»£p lá»‡.
- **Logic Phá»¥ thuá»™c:** Sá»­ dá»¥ng cÃ¡c phÆ°Æ¡ng thá»©c nÃ¢ng cao nhÆ° `.when()` vÃ  `.xor()` Ä‘á»ƒ xá»­ lÃ½ cÃ¡c logic validation phá»©c táº¡p.

#### Controllers (`src/controllers`)

ÄÃ¢y lÃ  "bá»™ nÃ£o" chá»©a toÃ n bá»™ logic nghiá»‡p vá»¥. Má»—i controller quáº£n lÃ½ má»™t resource cá»¥ thá»ƒ (vÃ­ dá»¥: `productController`, `orderController`).

- **Xá»­ lÃ½ Báº¥t Ä‘á»“ng bá»™:** Má»i hÃ m controller Ä‘á»u lÃ  `async` vÃ  Ä‘Æ°á»£c bá»c trong `asyncHandler` Ä‘á»ƒ tá»± Ä‘á»™ng báº¯t lá»—i vÃ  chuyá»ƒn Ä‘áº¿n `errorHandler`.
- **Logic "LÃ m pháº³ng" (Flattening):** Controllers chá»‹u trÃ¡ch nhiá»‡m "lÃ m pháº³ng" dá»¯ liá»‡u Ä‘a ngÃ´n ngá»¯. Dá»±a vÃ o `req.locale`, chÃºng sáº½ chá»n Ä‘Ãºng chuá»—i ngÃ´n ngá»¯ (`.vi` hoáº·c `.en`), giÃºp cho frontend client nháº­n Ä‘Æ°á»£c dá»¯ liá»‡u sáºµn sÃ ng Ä‘á»ƒ hiá»ƒn thá»‹. CÃ¡c API dÃ nh riÃªng cho admin sáº½ tráº£ vá» dá»¯ liá»‡u gá»‘c.
- **Aggregation Pipeline:** Sá»­ dá»¥ng máº¡nh máº½ **Aggregation Pipeline** cá»§a MongoDB Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c phÃ©p tÃ­nh toÃ¡n vÃ  tá»•ng há»£p dá»¯ liá»‡u phá»©c táº¡p (tÃ­nh doanh thu, bÃ¡o cÃ¡o, lá»c nÃ¢ng cao).

**Luá»“ng xá»­ lÃ½ trong má»—i hÃ m Controller:**

1. **Thu tháº­p dá»¯ liá»‡u Ä‘áº§u vÃ o:** Láº¥y dá»¯ liá»‡u tá»« `req.params`, `req.query`, `req.body`, `req.user` (Ä‘Ã£ Ä‘Æ°á»£c middleware xÃ¡c thá»±c) vÃ  `req.locale`.
2. **TÆ°Æ¡ng tÃ¡c vá»›i Model:** Gá»i cÃ¡c phÆ°Æ¡ng thá»©c cá»§a Mongoose (`.find()`, `.findById()`, `.aggregate()`, `.save()`) Ä‘á»ƒ thao tÃ¡c vá»›i database.
3. **Xá»­ lÃ½ logic nghiá»‡p vá»¥:** Thá»±c hiá»‡n cÃ¡c phÃ©p tÃ­nh, kiá»ƒm tra Ä‘iá»u kiá»‡n, vÃ  gá»i cÃ¡c hÃ m tiá»‡n Ã­ch (`utils`) náº¿u cáº§n (vÃ­ dá»¥: gá»­i email, táº¡o thÃ´ng bÃ¡o).
4. **Gá»­i Response:** Tráº£ vá» response cho client vá»›i status code vÃ  dá»¯ liá»‡u JSON phÃ¹ há»£p.

**CÃ¡c Status Code Response phá»• biáº¿n:**

- `200 OK`: Cho cÃ¡c request `GET` hoáº·c `PUT`/`PATCH` thÃ nh cÃ´ng.
- `201 Created`: Cho request `POST` táº¡o má»›i má»™t tÃ i nguyÃªn thÃ nh cÃ´ng.
- `204 No Content`: Cho request `DELETE` thÃ nh cÃ´ng (khÃ´ng tráº£ vá» body).
- `400 Bad Request`: Dá»¯ liá»‡u Ä‘áº§u vÃ o khÃ´ng há»£p lá»‡ (lá»—i tá»« Joi validation).
- `401 Unauthorized`: Lá»—i xÃ¡c thá»±c (thiáº¿u token, token sai/háº¿t háº¡n).
- `403 Forbidden`: ÄÃ£ xÃ¡c thá»±c nhÆ°ng khÃ´ng cÃ³ quyá»n truy cáº­p (vÃ­ dá»¥: user thÆ°á»ng cá»‘ truy cáº­p route admin, hoáº·c tÃ i khoáº£n bá»‹ Ä‘Ã¬nh chá»‰).
- `404 Not Found`: KhÃ´ng tÃ¬m tháº¥y tÃ i nguyÃªn Ä‘Æ°á»£c yÃªu cáº§u.
- `500 Internal Server Error`: Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh tá»« phÃ­a server.

#### Middlewares (`src/middlewares`)

- **`asyncHandler.js`:** Má»™t wrapper giÃºp báº¯t cÃ¡c lá»—i trong cÃ¡c hÃ m `async` vÃ  chuyá»ƒn chÃºng Ä‘áº¿n `errorHandler` má»™t cÃ¡ch tá»± Ä‘á»™ng.
- **`authMiddleware.js`:**
  - `protect`: Báº£o vá»‡ route, giáº£i mÃ£ **JWT**, tÃ¬m ngÆ°á»i dÃ¹ng, vÃ  kiá»ƒm tra tráº¡ng thÃ¡i `isActive` trÃªn **má»i request**.
  - `protectOptional`: Cá»‘ gáº¯ng xÃ¡c thá»±c ngÆ°á»i dÃ¹ng nhÆ°ng khÃ´ng bÃ¡o lá»—i náº¿u thiáº¿u token.
- **`localeMiddleware.js`:** Äá»c header `Accept-Language` vÃ  gáº¯n `req.locale`, lÃ m cÆ¡ sá»Ÿ cho logic Ä‘a ngÃ´n ngá»¯.
- **`identifyCartUser.js` & `identifyWishlistUser.js`:** CÃ¡c middleware thÃ´ng minh xÃ¡c Ä‘á»‹nh Ä‘á»‹nh danh cho giá» hÃ ng/wishlist (Æ°u tiÃªn `userId`, fallback vá» `guestId` trong cookie).
- **`validationMiddleware.js`:** Sá»­ dá»¥ng cÃ¡c schema tá»« `validations` Ä‘á»ƒ kiá»ƒm tra `req.body`.
- **`errorMiddleware.js`:** `notFound` (xá»­ lÃ½ lá»—i 404) vÃ  `errorHandler` (báº¯t táº¥t cáº£ cÃ¡c lá»—i khÃ¡c).

#### Routes (`src/routes`)

Äá»‹nh nghÄ©a cÃ¡c endpoint API theo chuáº©n RESTful, lÃ  cá»•ng giao tiáº¿p giá»¯a frontend vÃ  controllers.

- **Cáº¥u trÃºc:** Sá»­ dá»¥ng `express.Router()` Ä‘á»ƒ nhÃ³m cÃ¡c endpoint theo tá»«ng resource (vÃ­ dá»¥: `productRoutes.js`, `orderRoutes.js`).
- **PhÆ°Æ¡ng thá»©c HTTP:** Sá»­ dá»¥ng Ä‘Ãºng cÃ¡c phÆ°Æ¡ng thá»©c `GET`, `POST`, `PUT`, `DELETE` cho cÃ¡c hÃ nh Ä‘á»™ng CRUD tÆ°Æ¡ng á»©ng.
- **Gáº¯n Middlewares:** CÃ¡c route Ä‘Æ°á»£c gáº¯n vá»›i cÃ¡c middleware theo Ä‘Ãºng thá»© tá»± logic:
  `router.post('/', protect, isAdmin, validateRequest(schema), controllerFunction);`
- **TÃ¡ch biá»‡t Admin/Client:** Má»™t sá»‘ route cÃ³ cÃ¡c endpoint `/admin` riÃªng biá»‡t Ä‘á»ƒ tráº£ vá» dá»¯ liá»‡u gá»‘c, Ä‘a ngÃ´n ngá»¯, phá»¥c vá»¥ cho viá»‡c chá»‰nh sá»­a, trong khi cÃ¡c endpoint cÃ´ng khai tráº£ vá» dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c lÃ m pháº³ng.

**CÃ¡c API Endpoint chÃ­nh:**

| PhÆ°Æ¡ng thá»©c                 | Endpoint                     | Chá»©c nÄƒng                                             |
| :-------------------------- | :--------------------------- | :---------------------------------------------------- |
| **Authentication**          |                              |                                                       |
| `POST`                      | `/api/v1/auth/register`      | ÄÄƒng kÃ½ tÃ i khoáº£n má»›i.                                |
| `POST`                      | `/api/v1/auth/login`         | ÄÄƒng nháº­p vÃ  nháº­n Access Token.                       |
| `POST`                      | `/api/v1/auth/refresh`       | LÃ m má»›i Access Token báº±ng Refresh Token.              |
| `POST`                      | `/api/v1/auth/logout`        | ÄÄƒng xuáº¥t.                                            |
| **Products**                |                              |                                                       |
| `GET`                       | `/api/v1/products`           | Láº¥y danh sÃ¡ch sáº£n pháº©m (cÃ³ filter, sort, pagination). |
| `GET`                       | `/api/v1/products/:idOrSlug` | Láº¥y chi tiáº¿t má»™t sáº£n pháº©m.                            |
| `POST`                      | `/api/v1/products`           | **[Admin]** Táº¡o sáº£n pháº©m má»›i.                         |
| `PUT`                       | `/api/v1/products/:id`       | **[Admin]** Cáº­p nháº­t sáº£n pháº©m.                        |
| **Orders**                  |                              |                                                       |
| `GET`                       | `/api/v1/orders/my`          | **[User]** Láº¥y lá»‹ch sá»­ Ä‘Æ¡n hÃ ng.                      |
| `POST`                      | `/api/v1/orders`             | Táº¡o Ä‘Æ¡n hÃ ng má»›i tá»« giá» hÃ ng.                         |
| `GET`                       | `/api/v1/orders`             | **[Admin]** Láº¥y táº¥t cáº£ Ä‘Æ¡n hÃ ng.                      |
| `PUT`                       | `/api/v1/orders/:id/status`  | **[Admin]** Cáº­p nháº­t tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng.             |
| `POST`                      | `/api/v1/orders/:id/restock` | **[Admin]** KhÃ´i phá»¥c tá»“n kho cho Ä‘Æ¡n hÃ ng Ä‘Ã£ há»§y.    |
| **Dashboard & Reports**     |                              |                                                       |
| `GET`                       | `/api/v1/dashboard/stats`    | **[Admin]** Láº¥y cÃ¡c sá»‘ liá»‡u tá»•ng quan cho dashboard.  |
| `GET`                       | `/api/v1/reports/sales`      | **[Admin]** Láº¥y bÃ¡o cÃ¡o chi tiáº¿t vá» bÃ¡n hÃ ng.         |
| **VÃ  nhiá»u endpoints khÃ¡c** |                              | Cho `Users`, `Categories`, `Coupons`, `Reviews`,...   |

#### Utils (`src/utils`)

- **`generateToken.js`:** Logic táº¡o Access & Refresh Token báº±ng JWT.
- **`sendEmail.js`:** TÃ­ch há»£p **Nodemailer** Ä‘á»ƒ gá»­i email giao dá»‹ch.
- **`paypalClient.js`:** ÄÃ³ng gÃ³i toÃ n bá»™ logic giao tiáº¿p vá»›i **PayPal API**, bao gá»“m cáº£ viá»‡c láº¥y tá»· giÃ¡ tá»± Ä‘á»™ng tá»« **ExchangeRate-API**.
- **`cartUtils.js` & `wishlistUtils.js`:** Chá»©a logic nghiá»‡p vá»¥ phá»©c táº¡p nhÆ° tá»± Ä‘á»™ng gá»™p giá» hÃ ng/wishlist cá»§a khÃ¡ch sau khi há» Ä‘Äƒng nháº­p.
- **`notificationUtils.js`:** TÃ­ch há»£p vá»›i **Socket.IO** Ä‘á»ƒ "phÃ¡t" (`emit`) cÃ¡c thÃ´ng bÃ¡o real-time Ä‘áº¿n admin.
- **`logger.js`:** Cáº¥u hÃ¬nh **Winston** Ä‘á»ƒ táº¡o há»‡ thá»‘ng logging máº¡nh máº½.

#### App & Server (`src/app & src/server`)

- **Khá»Ÿi táº¡o & Láº¯p rÃ¡p:** `app.js` chá»‹u trÃ¡ch nhiá»‡m táº¡o instance cá»§a Express, cáº¥u hÃ¬nh cÃ¡c middleware toÃ n cá»¥c nhÆ° `cors`, `cookieParser`, `httpLoggerMiddleware`, `setLocale`, vÃ  sau Ä‘Ã³ "láº¯p rÃ¡p" táº¥t cáº£ cÃ¡c file routes vÃ o cÃ¡c Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng á»©ng. NÃ³ cÅ©ng Ä‘á»‹nh nghÄ©a middleware xá»­ lÃ½ lá»—i cuá»‘i cÃ¹ng.
- **Khá»Ÿi cháº¡y Server:** `server.js` lÃ  file thá»±c thi chÃ­nh. NÃ³ import `app` tá»« `app.js`, thá»±c hiá»‡n káº¿t ná»‘i Ä‘áº¿n database (`connectDB`), táº¡o má»™t server HTTP, vÃ  quan trá»ng nháº¥t lÃ  tÃ­ch há»£p **Socket.IO** vÃ o server HTTP Ä‘Ã³ báº±ng cÃ¡ch gá»i `initSocket(httpServer)`.

#### Socket.IO (`src/socket.js`)

- **Kiáº¿n trÃºc Real-time:** File nÃ y quáº£n lÃ½ toÃ n bá»™ logic giao tiáº¿p thá»i gian thá»±c.
- **XÃ¡c thá»±c Admin:** Socket.IO cÃ³ má»™t middleware (`io.use`) riÃªng Ä‘á»ƒ xÃ¡c thá»±c cÃ¡c káº¿t ná»‘i tá»« client admin. NÃ³ yÃªu cáº§u client gá»­i JWT qua `socket.handshake.auth.token`, giáº£i mÃ£ token, vÃ  kiá»ƒm tra vai trÃ² `admin` trÆ°á»›c khi cho phÃ©p káº¿t ná»‘i.
- **Quáº£n lÃ½ káº¿t ná»‘i:** Sá»­ dá»¥ng má»™t `Map` (`adminSockets`) Ä‘á»ƒ theo dÃµi cÃ¡c admin Ä‘ang online (Ã¡nh xáº¡ `userId` -> `socket.id`).
- **PhÃ¡t sá»± kiá»‡n:** Cung cáº¥p má»™t hÃ m `emitToAdmins` cÃ³ thá»ƒ Ä‘Æ°á»£c gá»i tá»« báº¥t ká»³ Ä‘Ã¢u trong á»©ng dá»¥ng (vÃ­ dá»¥: tá»« `notificationUtils`) Ä‘á»ƒ gá»­i sá»± kiá»‡n Ä‘áº¿n má»™t hoáº·c táº¥t cáº£ cÃ¡c admin Ä‘ang káº¿t ná»‘i, táº¡o ra cÃ¡c thÃ´ng bÃ¡o real-time.
